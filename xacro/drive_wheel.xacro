<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro">

    <!-- Load physics parameters -->
    <xacro:include filename="$(find barista_robot_description)/xacro/physics_properties.xacro"/>

    <!-- Drive wheel macro --> 
    <xacro:macro name="drive_wheel" params="prefix reflect robot_name">
        
    <!-- Xacro properties for wheel dimensions -->
    <xacro:property name="wheel_radius" value="0.0352"/>
    <xacro:property name="wheel_width" value="0.0206"/>
    
    <link name="${prefix}_wheel">      
        <visual>
            <geometry>
                <cylinder length="${wheel_width}" radius="${wheel_radius}"/>
            </geometry>
            <material name="black"/>
        </visual>
        
        <collision>
            <geometry>
                <cylinder length="${wheel_width}" radius="${wheel_radius}"/>
            </geometry>
        </collision>
        
        <inertial>
            <mass value="${physics_config['wheel_mass']}"/>
            <!-- <inertia ixx="${physics_config['wheel_ixx_factor']}" 
                     iyy="${physics_config['wheel_iyy_factor']}" 
                     izz="${physics_config['wheel_izz_factor']}"
                     ixy="0" ixz="0" iyz="0"/> -->
            <inertia ixx="${(1/12) * physics_config['wheel_mass'] * (3 * wheel_radius * wheel_radius + wheel_width * wheel_width)}" 
                     iyy="${(1/12) * physics_config['wheel_mass'] * (3 * wheel_radius * wheel_radius + wheel_width * wheel_width)}" 
                     izz="${(1/2) * physics_config['wheel_mass'] * wheel_radius * wheel_radius}"
                     ixy="0" ixz="0" iyz="0"/>         
            <!-- <inertia ixx="${physics_config['wheel_mass'] * physics_config['wheel_ixx_factor']}" 
                    iyy="${physics_config['wheel_mass'] * physics_config['wheel_iyy_factor']}" 
                    izz="${physics_config['wheel_mass'] * physics_config['wheel_izz_factor']}"
                    ixy="0" ixz="0" iyz="0"/> -->

        </inertial>
    </link>

    <gazebo reference="${prefix}_wheel">
        <material>Gazebo/Black</material>
        <mu>${physics_config['drive_mu']}</mu> 
        <mu2>${physics_config['drive_mu']}</mu2> 
        <slip1>${physics_config['drive_slip']}</slip1>
        <slip2>${physics_config['drive_slip']}</slip2>
        <kp>${physics_config['drive_kp']}</kp> 
        <kd>${physics_config['drive_kd']}</kd> 
    </gazebo>

    <joint name="joint_${prefix}_wheel" type="continuous">
        <origin rpy="1.5707 0 0" xyz="0.0 ${reflect * 0.14} -0.070"/>
        <child link="${prefix}_wheel"/>
        <parent link="chassis"/>
        <axis rpy="0 0 0" xyz="0 0 1"/>
        <limit effort="10000" velocity="1000"/>
        <!-- <joint_properties damping="3.0" friction="0.4"/> -->
        <joint_properties damping="${physics_config['wheel_damping']}" 
                        friction="${physics_config['wheel_friction']}"/>
    </joint>

  </xacro:macro>

</robot>